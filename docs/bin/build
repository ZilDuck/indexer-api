#!/usr/bin/env bash
set -e

if [ $# -eq 0 ]
  then
    tag="latest"
  else
    tag=$1
fi

echo "Using tag $tag"

docker run --rm --name slate -v ./build:/srv/slate/build -v ./source:/srv/slate/source slatedocs/slate build
docker build ./build -f ./Dockerfile.deploy -t 465700395685.dkr.ecr.eu-west-1.amazonaws.com/indexer/api-docs:$tag
docker push 465700395685.dkr.ecr.eu-west-1.amazonaws.com/indexer/api-docs:$tag
